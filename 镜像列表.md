## 已有镜像列表
### 对外镜像
​	对外镜像都放于[DockerHub](https://hub.docker.com/u/easysoft)上，存放了不同产品不同版本的Docker镜像，任何人都可以拉取。

* 制作新版本的Docker镜像方式可以参考[Docker README.md](https://svn.zcorp.cc/easysoft/trunk/docker/REAFME.md)针对我们产品线镜像的使用方法参考[Docker方式部署禅道](https://www.zentao.net/book/zentaopmshelp/40.html)；
* 最新制作的镜像，系统都是ubuntu18.04，默认安装了php7.2、mariadb10.1.44、ioncube服务，并且可以在apache2和nginx二选一，不指定默认是apache2服务；
* 针对我们产品线镜像的使用方法参考[Docker方式部署禅道](https://www.zentao.net/book/zentaopmshelp/40.html)。

| 产品线 | 镜像地址                                      |
| ------ | --------------------------------------------- |
| zentao | https://hub.docker.com/r/easysoft/zentao/tags |
| zsite  | https://hub.docker.com/r/easysoft/zsite/tags  |
| zdoo   | https://hub.docker.com/r/easysoft/zdoo/tags   |

### 对内镜像

​	我们有内部的镜像库，地址为http://hub.zcorp.cc/，里面的镜像用于我们后台部署云产品和网站等。

| 产品线             | 镜像名字                    | 拉取命令                                                 | 镜像描述                                                     |
| ------------------ | --------------------------- | -------------------------------------------------------- | ------------------------------------------------------------ |
| 云渠成（qcmmi）    | qcmmi/plat:v1.5.Beta        | ```docker pull hub.zcorp.cc/qcmmi/plat:v1.5.Beta```      | 云渠成主站点                                                 |
| 云渠成（qcmmi）    | qcmmi/node:v1.5.Beta        | ```docker pull hub.zcorp.cc/qcmmi/node:v1.5.Beta```      | 云渠成分站点                                                 |
| 云zdoo             | zdoo/node:biz5.0            | ```docker pull hub.zcorp.cc/zdoo/node:biz5.0```          | 云zdoo的分站点                                               |
| 云禅道（zentaopm） | zentaopm/node:biz3.7        | ```docker pull hub.zcorp.cc/zentaopm/node:biz3.7```      | 云禅道分站点                                                 |
| 云禅道（zentaopm） | zentaopm/node:biz3.7_cron   | ```docker pull hub.zcorp.cc/zentaopm/node:biz3.7_cron``` | 云禅道分站点(增加计划任务)                                   |
| zsite              | zsite/web:nginx             | ```docker pull hub.zcorp.cc/zsite/web:nginx```           | 部署http服务的zsite，容器没有mysql服务                       |
| zsite              | zsite/web:nginx_ssl         | ```docker pull hub.zcorp.cc/zsite/web:nginx_ssl```       | 主要用于web节点部署的站点服务，容器没有mysql服务，数据库都使用的物理机上的数据库 |
| zsite              | zsite/web:nginx_ssl_mariadb | ```docker pull hub.zcorp.cc/zsite/web:nginx```           | 部署https服务的zsite，内置了mariadb服务                      |

#### 拉取内部镜像库镜像步骤

1. 安装docker服务并且能与192.168.100.3进行网络通信

2. 编辑```/etc/docker/daemon.json```，增加如下内容

   ```shell
     {
         "insecure-registries": ["192.168.100.3:8080", "hub.zcorp.cc", "hub.zcorp.cc:8080"]
     }
   ```

3. 重载docker服务
   ```shell
   service docker reload 或systemctl daemon-reload
   ```
   
4. 选择对应镜像的拉取命令进行下载

### 内部镜像库的搭建和使用
1. 下载并安装docker和docker-compose

2. 创建空目录，下载Harbor安装包[Harbor](https://goharbor.io/docs/2.0.0/install-config/reconfigure-manage-lifecycle/)

3. 修改该目录下的harbor.yml配置文件然后执行./install.sh

4. 登陆http://hub.zcorp.cc/，管理员admin，密码zentao，即可通过浏览器查看现有镜像

### 内部镜像的使用方式

1. 云渠成qcmmi

   ```shell
   docker run --restart=always --name qcmmi_plat -p 20000:443 -p 20001:3306 -v /home/z/qucheng/plat/qcmmi:/app/qcmmi -v /home/z/qucheng/plat/qcmmi_plat_mysql:/var/lib/mysql -v /etc/certs/live/qcmmi.com:/etc/apache/certs -v /etc/certs/archive:/etc/archive -v /etc/localtime:/etc/localtime -d hub.zcorp.cc/qcmmi/plat:v1.5.Beta
   ```

   ```shell
   docker run --restart=always --name qcmmi_node -p 20002:80 -p 20003:3306 -v /home/z/qucheng/node/zentaoqc:/app/zentaoqc -v /home/z/qucheng/node/qcmmi_node_mysql:/var/lib/mysql -v /etc/localtime:/etc/localtime -d hub.zcorp.cc/qcmmi/node:v1.5.Beta
   ```

2. 云zdoo

   ``` shell
   docker run --restart=always --name zdoo_node -p 20000:443 -p 20001:3306 -v /home/z/zdoo/saas:/app/zdoonode -v /home/z/zdoo/zdoo_node_mysql:/var/lib/mysql -v  /etc/letsencrypt/live/yoyibao.com:/etc/letsencrypt/live/ -v /etc/letsencrypt/archive:/etc/archive -v /etc/localtime:/etc/localtime -d hub.zcorp.cc/zdoo/node:biz5.0
   ```

2. 云禅道zentaopm

   ```shell
   docker run --restart=always --name zentao_node3 -p 80:80 -p 443:443 -p 20000:3306 -v /home/data/zentao/zentaopms:/www/zentaopms -v /home/data/zentao/zentao_mysql:/var/lib/mysql -v /home/data/zentao/zentao_data:/home/data/ -d zentaopm/node:biz3.7_cron
   ```
   
2. zsite
   ```shell
docker run --restart=always --name  xuanim --add-host ext.license.cnezsoft.com:192.168.100.3 --add-host pro.license.cnezsoft.com:192.168.100.3 -p 9013:443 -v /home/data/sites/xuanim:/www/chanzhi -v /home/data/sites/data:/home/data/sites/data -v /etc/certs/live/xuanim.com:/etc/nginx/certs -v /etc/certs/archive:/etc/archive -d 192.168.100.3:8080/zsite/web:nginx_ssl
   ```